(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{227:function(s,t,a){"use strict";a.r(t);var e=a(0),n=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"deploying-versions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deploying-versions","aria-hidden":"true"}},[s._v("#")]),s._v(" Deploying Versions")]),s._v(" "),a("p",[s._v("Deploying (/building) new versions of Directus is a multifaceted process. The application and api should be treated as two separate entities, only to be bundled together for a final build.")]),s._v(" "),a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),a("p",[s._v("These steps need to be followed precisely. Any deviation will cause breaking changes.")])]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("Automated")]),s._v(" "),a("p",[s._v("Eventually, we want to automate these steps in some sort of deploy script to make sure the build is the same each time.")])]),s._v(" "),a("h2",{attrs:{id:"deploying-the-application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deploying-the-application","aria-hidden":"true"}},[s._v("#")]),s._v(" Deploying the application")]),s._v(" "),a("ol",[a("li",[s._v("Clone the app repo")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git@github.com:directus/app.git\n$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" app\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[s._v("Bump the version in "),a("code",[s._v("package.json")])])]),s._v(" "),a("li",[a("p",[s._v("Install npm dependencies")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("Build the app")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("Clone the build branch of the app")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\n$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" clone -b build git@github.com:directus/app.git app-build\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[a("p",[s._v("Delete everything in "),a("code",[s._v("app-build")]),s._v(" except the "),a("code",[s._v(".git")]),s._v(" folder")])]),s._v(" "),a("li",[a("p",[s._v("Copy everything from "),a("code",[s._v("app/dist")]),s._v(" to "),a("code",[s._v("app-build")])])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r app/dist/. app-build\n")])])]),a("ol",{attrs:{start:"8"}},[a("li",[s._v("Delete all .DS_Store files")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" app-build\n$ "),a("span",{attrs:{class:"token function"}},[s._v("find")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v(" -name "),a("span",{attrs:{class:"token string"}},[s._v("'.DS_Store'")]),s._v(" -type f -delete\n")])])]),a("ol",{attrs:{start:"9"}},[a("li",[s._v("Add-commit-push")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" add "),a("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v("\n$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" commit -m "),a("span",{attrs:{class:"token string"}},[s._v('"<VERSION NUMBER>"')]),s._v("\n$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" push origin build\n")])])]),a("ol",{attrs:{start:"10"}},[a("li",[a("p",[s._v("Create release on GH")])]),s._v(" "),a("li",[a("p",[s._v("Delete local repos")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n$ "),a("span",{attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf app\n$ "),a("span",{attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf app-build\n")])])]),a("h2",{attrs:{id:"deploying-the-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deploying-the-api","aria-hidden":"true"}},[s._v("#")]),s._v(" Deploying the API")]),s._v(" "),a("ol",[a("li",[s._v("Clone the api repo")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git@github.com:directus/api.git\n$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" api\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[s._v("Bump the version in "),a("code",[s._v("package.json")]),s._v(" and "),a("code",[s._v("src/core/Directus/Application/Application.php")])])]),s._v(" "),a("li",[a("p",[s._v("Install the composer dependencies")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ composer "),a("span",{attrs:{class:"token function"}},[s._v("install")]),s._v(" -a\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("Install and build the system extensions")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" extensions\n$ "),a("span",{attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("install")]),s._v("\n$ "),a("span",{attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build\n$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("Clone the build branch of the api")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" clone -b build git@github.com:directus/api.git api-build\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[a("p",[s._v("Delete everything in "),a("code",[s._v("api-build")]),s._v(" except the "),a("code",[s._v(".git")]),s._v(" folder")])]),s._v(" "),a("li",[a("p",[s._v("Delete all nested .git folders (prevent submodules)")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" api/vendor\n$ "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("find")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v(" -type d -name "),a("span",{attrs:{class:"token string"}},[s._v('".git"')]),s._v(" \\\n  "),a("span",{attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("find")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v(" -name "),a("span",{attrs:{class:"token string"}},[s._v('".gitignore"')]),s._v(" \\\n  "),a("span",{attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("find")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v(" -name "),a("span",{attrs:{class:"token string"}},[s._v('".gitmodules"')]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf\n$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])])]),a("ol",{attrs:{start:"8"}},[a("li",[s._v("Move these files into "),a("code",[s._v("api-build")]),s._v(":")])]),s._v(" "),a("ul",[a("li",[s._v("bin/")]),s._v(" "),a("li",[s._v("config/")]),s._v(" "),a("li",[s._v("docker/")]),s._v(" "),a("li",[s._v("logs/")]),s._v(" "),a("li",[s._v("migrations/")]),s._v(" "),a("li",[s._v("public/")]),s._v(" "),a("li",[s._v("src/")]),s._v(" "),a("li",[s._v("vendor/")]),s._v(" "),a("li",[s._v("LICENSE.md")]),s._v(" "),a("li",[s._v("README.md")]),s._v(" "),a("li",[s._v("docker-compose.yml")])]),s._v(" "),a("ol",{attrs:{start:"9"}},[a("li",[s._v("Delete all .DS_Store files")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" api-build\n$ "),a("span",{attrs:{class:"token function"}},[s._v("find")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v(" -name "),a("span",{attrs:{class:"token string"}},[s._v("'.DS_Store'")]),s._v(" -type f -delete\n")])])]),a("ol",{attrs:{start:"10"}},[a("li",[s._v("Add this .gitignore file:")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Icon\n.DS_Store\n*.log\n.cache\n\n# Ignore dev files\n/.idea\nnode_modules\n\npackage-lock.json\n\n# Don't track composer phar/vendors\ncomposer.phar\ncomposer.lock\n\n# Ignore configuration files\n/config/*\n!/config/migrations.php\n!/config/migrations.upgrades.php\n!/config/api_sample.php\n\n# PHPUnit\n/phpunit.xml\n/documents\n\n# Custom extensions\n/public/extensions/custom/*/*\n\n##  Auth\n/public/extensions/custom/auth\n\n##  Endpoints\n!/public/extensions/custom/endpoints/_directory/\n!/public/extensions/custom/endpoints/_example.php\n\n##  Hashers\n!/public/extensions/custom/hashers/_CustomHasher.php\n\n##  Hooks\n!/public/extensions/custom/hooks/_products\n!/public/extensions/custom/hooks/_webhook\n\n# Storage\n/public/uploads/*/\n!public/uploads/_/originals/.gitignore\n!public/uploads/_/thumbnails/.gitignore\n\n# Keep gitkeep files\n# This will make sure empty directories has at least one file so it can be tracked by git\n!**/.gitkeep\n")])])]),a("ol",{attrs:{start:"11"}},[a("li",[s._v("Add-commit-push")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" add "),a("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v("\n$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" commit -m "),a("span",{attrs:{class:"token string"}},[s._v('"<VERSION NUMBER>"')]),s._v("\n$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" push origin build\n")])])]),a("ol",{attrs:{start:"12"}},[a("li",[a("p",[s._v("Create release on GH")])]),s._v(" "),a("li",[a("p",[s._v("Delete local repos")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n$ "),a("span",{attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf api\n$ "),a("span",{attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf api-build\n")])])]),a("h2",{attrs:{id:"deploying-the-combined-build"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deploying-the-combined-build","aria-hidden":"true"}},[s._v("#")]),s._v(" Deploying the combined build")]),s._v(" "),a("ol",[a("li",[s._v("Clone the directus/directus repo")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" clone git@github.com:directus/directus.git\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[s._v("Delete everything in it except the "),a("code",[s._v(".git")]),s._v(" folder")])]),s._v(" "),a("li",[a("p",[s._v("Clone the api build")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" clone -b build git@github.com:directus/api.git api-build\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("Remove the "),a("code",[s._v(".git")]),s._v(" folder from the "),a("code",[s._v("api-build")]),s._v(" folder")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf api-build/.git\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("Copy everything in the api-build folder to the main directus/directus repo")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r api-build/* directus\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[s._v("Clone the app build")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" clone -b build git@github.com:directus/app.git app-build\n")])])]),a("ol",{attrs:{start:"7"}},[a("li",[s._v("Make the public/admin directory in directus/directus")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" directus/public/admin\n")])])]),a("ol",{attrs:{start:"8"}},[a("li",[s._v("Delete the "),a("code",[s._v(".git")]),s._v(" folder from the app-build")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf app-build/.git\n")])])]),a("ol",{attrs:{start:"9"}},[a("li",[s._v("Copy everything from app-build to directus/public/admin")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r app-build/* directus/public/admin\n")])])]),a("ol",{attrs:{start:"10"}},[a("li",[s._v("Duplicate the "),a("code",[s._v("directus/public/admin/config_example.js")]),s._v(" file to "),a("code",[s._v("directus/public/admin/config.js")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cp")]),s._v(" directus/public/admin/config_example.js directus/public/admin/config.js\n")])])]),a("ol",{attrs:{start:"11"}},[a("li",[s._v("Change the "),a("code",[s._v("directus/public/admin/config.js")]),s._v(" file to point to the relative API")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("api"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token string"}},[s._v('"../_/"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"Directus API"')]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("ol",{attrs:{start:"12"}},[a("li",[s._v("Delete all .DS_Store files")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" directus\n$ "),a("span",{attrs:{class:"token function"}},[s._v("find")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v(" -name "),a("span",{attrs:{class:"token string"}},[s._v("'.DS_Store'")]),s._v(" -type f -delete\n")])])]),a("ol",{attrs:{start:"13"}},[a("li",[s._v("Add-commit-push")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" add "),a("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v("\n$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" commit -m "),a("span",{attrs:{class:"token string"}},[s._v('"<VERSION NUMBER>"')]),s._v("\n$ "),a("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" push origin master\n")])])]),a("ol",{attrs:{start:"14"}},[a("li",[a("p",[s._v("Create release on GH")])]),s._v(" "),a("li",[a("p",[s._v("Delete local repos")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n$ "),a("span",{attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf directus\n$ "),a("span",{attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf api-build\n$ "),a("span",{attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf app-build\n")])])]),a("h2",{attrs:{id:"tagging-docs-releases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tagging-docs-releases","aria-hidden":"true"}},[s._v("#")]),s._v(" Tagging Docs Releases")]),s._v(" "),a("p",[s._v("When releasing a new major or minor version (not a patch) we should also create a git release tag on "),a("code",[s._v("directus/docs")]),s._v(". This will ensure that users of previous versions can go back and look at the specific docs from that version.")]),s._v(" "),a("p",[s._v("It's also important to "),a("em",[s._v("flag")]),s._v(" each new feature in the Docs with a version number (eg: "),a("code",[s._v("7.1+")]),s._v(") so that users can tell when a new feature was made available.")])])}],!1,null,null,null);n.options.__file="deploying-versions.md";t.default=n.exports}}]);